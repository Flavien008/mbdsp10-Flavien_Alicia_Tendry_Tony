<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">

<body>
<div layout:fragment="content">
    <style>
        .container-image {
            max-width: 960px;
        }

        .container-image h1 {
            font-size: 20px;
            text-align: center;
            margin: 20px 0 20px;
        }

        .container-image h1 small {
            display: block;
            font-size: 15px;
            padding-top: 8px;
            color: gray;
        }

        .avatar-upload {
            position: relative;
            max-width: 205px;
            margin: 50px auto;
        }

        .avatar-upload .avatar-edit {
            position: absolute;
            right: 12px;
            z-index: 1;
            top: 10px;
        }

        .avatar-upload .avatar-edit input {
            display: none;
        }

        .avatar-upload .avatar-edit input + label {
            display: inline-block;
            width: 34px;
            height: 34px;
            margin-bottom: 0;
            border-radius: 100%;
            background: #FFFFFF;
            border: 1px solid transparent;
            box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.12);
            cursor: pointer;
            font-weight: normal;
            transition: all .2s ease-in-out;
        }

        .avatar-upload .avatar-edit input + label:hover {
            background: #f1f1f1;
            border-color: #d6d6d6;
        }

        .avatar-upload .avatar-edit input + label:after {
            font-family: 'FontAwesome';
            color: #757575;
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            text-align: center;
            margin: auto;
        }

        .avatar-upload .avatar-preview {
            width: 192px;
            height: 192px;
            position: relative;
            border-radius: 50%;
            border: 6px solid #F8F8F8;
            box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.1);
        }

        .avatar-upload .avatar-preview > div {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }

    </style>
    <div class="container-xl">
        <div class="d-flex flex-row justify-content-between">
            <div class="col-auto">
                <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='currentColor'/%3E%3C/svg%3E&#34;);"
                     aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/post/}"><span class="app-page-title">Post</span></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page"><span class="app-page-title">Ajout</span>
                        </li>
                    </ol>
                </nav>
            </div>


        </div>

        <div class="app-card alert alert-dismissible shadow-sm mb-4 border-left-decoration" categorie="alert">
            <div class="inner">
                <div class="app-card-body p-3 p-lg-4">
                    <!--                    <h3 class="mb-3">Bienvenue!</h3>-->
                    <div class="row gx-5 gy-3">
                        <div class="col-12 col-lg-9">

                            <div>Vous pouvez ajouter un nouveau post ici.
                                Remplissez le formulaire ci-dessous avec les informations du post que vous souhaitez
                                ajouter.
                                Si vous avez besoin d'aide ou de support, n'hésitez pas à nous contacter. Bonne journée
                                !
                            </div>
                        </div><!--//col-->

                    </div><!--//row-->
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div><!--//app-card-body-->

            </div><!--//inner-->
        </div>

        <div class="mt-4">
            <form class="row" th:action="@{/post/add}" th:object="${post}" method="post" enctype="multipart/form-data">
                <div class="col-md-6">
                    <div class="alert alert-danger" th:if="${error} "><span th:text="${error}"></span></div>
                    <div class="form-group ">
                        <label for="titre">Titre </label>
                        <input type="text" id="titre" th:field="*{titre}" class="form-control" placeholder="">
                    </div>
                    <div class="form-group mt-3">
                        <label for="description">Description </label>
                        <textarea id="description" rows="5" th:field="*{description}" class="form-control"></textarea>
                    </div>

                    <div class="form-group mt-3">
                        <label for="latitude">Localisation </label>
                        <input type="hidden" id="latitude" th:field="*{latitude}" class="form-control"
                               placeholder="">
                        <input type="hidden" id="longitude" th:field="*{longitude}" class="form-control"
                               placeholder="">
                    </div>
                    <div id="map" style="height: 500px;"></div>
                </div>

                <div class="container-xl">
                    <label for="objets">Objets </label>
                    <div id="objets" class="row mt-3 g-4 d-flex flex-row flex-wrap">
                        <div class="col-6 col-md-4 col-xl-3 col-xxl-2">
                            <div class="app-card app-card-doc shadow-sm  h-100">
                                <div class="app-card-thumb-holder p-3">
                                    <div class="app-card-thumb">
                                        <img class="thumb-image" src="assets/images/doc-thumb-1.jpg" alt="">
                                    </div>
                                    <a class="app-card-link-mask" href="#file-link"></a>
                                </div>
                                <div class="app-card-body p-3 has-card-actions">

                                    <h4 class="app-doc-title truncate mb-0"><a th:href="@{/objet/detail}">Nom</a></h4>
                                    <div class="app-doc-meta">
                                        <ul class="list-unstyled mb-0">
                                            <li><span class="text-muted">Catégorie:</span> Image</li>
                                        </ul>
                                    </div>

                                    <div class="app-card-actions">
                                        <div class="dropdown">
                                            <div class="dropdown-toggle no-toggle-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-three-dots-vertical" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                                </svg>
                                            </div>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="#"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-trash me-2" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                                </svg>Delete</a></li>
                                            </ul>
                                        </div>
                                    </div>

                                </div>

                            </div>
                            </div>
                        <div>
                        <button type="button" class="btn btn-outline-primary" ><i class="fa fa-plus-circle" ></i></button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <button type="submit" class="btn btn-primary mt-3">Enregistrer</button>
                </div>

            </form>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Coordonnées par défaut sur Antananarivo
            var defaultLat = -18.8792;
            var defaultLng = 47.5079;

            // Fonction pour mettre à jour les champs du formulaire
            function updateForm(lat, lng) {
                document.getElementById('latitude').value = lat;
                document.getElementById('longitude').value = lng;
            }

            // Initialiser la carte
            var map = L.map('map').setView([defaultLat, defaultLng], 13);

            // Ajouter les tuiles OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // Ajouter un marqueur par défaut sur Antananarivo
            var marker = L.marker([defaultLat, defaultLng], {
                draggable: true  // Le marqueur est draggable (peut être déplacé)
            }).addTo(map);

            // Si la géolocalisation est supportée par le navigateur
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    // Si la géolocalisation est réussie
                    var lat = position.coords.latitude;
                    var lng = position.coords.longitude;

                    // Centrer la carte sur la position actuelle
                    map.setView([lat, lng], 13);

                    // Déplacer le marqueur à la position actuelle
                    marker.setLatLng([lat, lng]);

                    // Mettre à jour les champs du formulaire avec la position actuelle
                    updateForm(lat, lng);
                }, function() {
                    // Si la géolocalisation échoue ou est refusée, centrer sur Antananarivo
                    updateForm(defaultLat, defaultLng);
                });
            } else {
                // Si la géolocalisation n'est pas supportée, centrer sur Antananarivo
                updateForm(defaultLat, defaultLng);
            }

            // Écouteur pour les clics sur la carte
            map.on('click', function(e) {
                var lat = e.latlng.lat;
                var lng = e.latlng.lng;

                // Déplacer le marqueur à la nouvelle position
                marker.setLatLng(e.latlng);

                // Mettre à jour les champs de formulaire avec les nouvelles coordonnées
                updateForm(lat, lng);
            });

            // Écouteur pour le drag du marqueur
            marker.on('dragend', function() {
                var latLng = marker.getLatLng();
                updateForm(latLng.lat, latLng.lng);
            });
        });
    </script>


</div>

</body>

</html>
<!-- Header -->
<app-header></app-header>

<!-- Page Title-->
<div class="bg-accent pt-4 pb-5"></div>

<div class="container pb-5 mb-2 mb-md-4">
  <!-- Toolbar-->
  <div class="bg-light shadow-lg rounded-3 p-4 mt-n5 mb-4">
    <div class="row gy-3 gx-4 justify-content-between">
      <div class="col-lg-2 col-md-3 col-sm-5 col-12 order-md-1 order-sm-2 order-3">
        <div class="dropdown">
          <a class="btn btn-outline-secondary dropdown-toggle w-100" href="javascript:void(0);" data-bs-toggle="collapse" data-bs-target="#shop-filters" (click)="collapse.toggle()">
            <i class="ci-filter me-2"></i>Filtres
          </a>
        </div>
      </div>
      <div class="col-md col-12 order-md-2 order-sm-1 order-1">
        <div class="input-group">
          <input class="form-control pe-5 rounded" type="text" placeholder="Recherche..." [(ngModel)]="searchTerm" (ngModelChange)="onSearchTermChange()" />
          <i class="ci-search position-absolute top-50 end-0 translate-middle-y zindex-5 me-3"></i>
        </div>
      </div>
      <div class="col-lg-3 col-md-4 col-sm-7 col-12 order-md-3 order-sm-3 order-2">
        <div class="d-flex align-items-center flex-shrink-0">
          <label class="form-label mb-0 me-2 pe-1 fw-normal text-nowrap d-sm-block d-none">Sort by:</label>
          <select class="form-select" [(ngModel)]="sortByDate" (change)="onSortChange($event)">
            <option value="DESC">Plus récent</option>
            <option value="ASC">Plus anciens</option>
          </select>
        </div>
      </div>
    </div>
    <!-- Toolbar with expandable filters-->
    <div class="collapse" #collapse="ngbCollapse" [(ngbCollapse)]="isCollapsed" id="shop-filters">
      <div class="row g-4 pt-4">
        <div class="col-lg-6 col-sm-8">
          <!-- Categories-->
          <div class="card">
            <div class="card-body px-12">
              <div class="widget">
                <h3 class="widget-title mb-2 pb-1">Categories</h3>
                <ul class="widget-list list-unstyled">
                  <li class="d-flex justify-content-between align-items-center mb-1">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="all" (change)="onCategoryChange('')"/>
                      <label class="form-check-label" for="all">All</label>
                    </div>
                  </li>
                  <li class="d-flex justify-content-between align-items-center mb-1" *ngFor="let category of categories">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" [id]="category.categorie_id" (change)="onCategoryChange(category.categorie_id)"/>
                      <label class="form-check-label" [for]="category.categorie_id">{{category.nom}}</label>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Products grid-->
  <div class="row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-1 gy-sm-4 gy-3 pt-sm-3">
    <div class="col" *ngFor="let product of allproduct; trackBy: trackByFn">
      <article>
          <div class="card mb-3">
              <div class="card-body p-3">
                  <div class="d-flex align-items-center justify-content-between mb-3">
                      <div class="d-inline-flex align-items-center position-relative">
                          
                          <div class="fs-sm">
                              by
                              <a class="ms-1 fw-medium text-accent stretched-link" routerLink="/vendor">
                                  &#64;{{product.Utilisateur.username}}
                              </a>
                          </div>
                      </div>
                      <button class="btn-wishlist btn-sm flex-shrink-0 ms-3" type="button" data-bs-toggle="tooltip" data-bs-placement="left" ngbTooltip="Remove">
                          <i class="ci-trash"></i>
                      </button>
                  </div>
                  <a class="d-block" routerLink="/auctionbuy/{{product.poste_id}}">
                      <div class="row row-cols-2 g-2">
                          <div class="col" *ngFor="let image of product.collageImages">
                              <img class="rounded-1" [src]="image.img" alt="Collection item">
                          </div>
                      </div>
                  </a>
              </div>
          </div>
          <h3 class="h5 mb-1">
              <a class="nav-link-style" routerLink="/auctionbuy/{{product.poste_id}}">
                  {{product.titre}}
              </a>
          </h3>
      </article>
    </div>
  </div>
  <div class="text-center" id="elmLoader" *ngIf="isLoading">
    <div class="spinner-border text-primary avatar-sm" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  <div *ngIf="!isAuthenticated">
    <div class="container pb-5 mb-2 mb-md-4">
      <div class="alert alert-warning" role="alert">
        <h4 class="alert-heading">Vous n'êtes pas connecté !</h4>
        <p>Veuillez vous connecter pour accéder à cette page.</p>
      </div>
    </div>
  </div>
  <hr class="mt-4 mb-3" />
  <!-- Pagination -->
  <ngb-pagination class="d-flex justify-content-center pt-2" [collectionSize]="total" [(page)]="page" [pageSize]="pageSize" aria-label="Custom pagination">
    <ng-template ngbPaginationPrevious let-page let-pages="pages">
      <i class="ci-arrow-left me-2"></i>
      Prev
    </ng-template>
    <ng-template ngbPaginationNext>
      Next
      <i class="ci-arrow-right ms-2"></i>
    </ng-template>
  </ngb-pagination>
</div>

<app-footer></app-footer>
